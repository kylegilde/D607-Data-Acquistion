---
title: "D607 Project 2 - Tidy Data"
author: "Kyle Gilde"
date: "Mar. 4, 2017"
output: 
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

#The Task
Choose any three of the "wide" datasets identified in the Week 5 Discussion items. (You may use your own dataset; please don't use my Sample Post dataset, since that was used in your Week 6 assignment!) 
 
For each of the three chosen datasets:

1.  Create a .CSV file (or optionally, a MySQL database!) that includes all of the information included in the dataset. You're encouraged to use a "wide" structure similar to how the information appears in the discussion item, so that you can practice tidying and transformations as described below.

2.  Read the information from your .CSV file into R, and use tidyr and dplyr as needed to tidy and transform your data. [Most of your grade will be based on this step!]

3.  Perform the analysis requested in the discussion item.

#Load Packages
```{r setup} 
knitr::opts_chunk$set(#echo=FALSE, 
                      warning=FALSE, 
                      message=FALSE,
                      tidy=F,
                      #comment = "",
                      dev="png", 
                      dev.args=list(type="cairo"))
#https://cran.r-project.org/web/packages/prettydoc/vignettes/
#https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf

load.packages <- c("stringr","prettydoc", "tidyr", "dplyr", "knitr", "janitor")

ipak <- function(pkg){
    #FUNCTION SOURCE: https://gist.github.com/stevenworthington/3178163
    new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
    if (length(new.pkg)) 
        install.packages(new.pkg, dependencies = TRUE)
    sapply(pkg, require, character.only = TRUE, quietly = TRUE, warn.conflicts = FALSE)
}

ipak(load.packages)
```

#Dataset #1: Nkasi's Congressional Voting Records
##Load data, get headers & take a look at it
```{r load}
ds1 <- read.csv("https://archive.ics.uci.edu/ml/machine-learning-databases/voting-records/house-votes-84.data", header = F, stringsAsFactors = F)

#get the header names
ds1_names <- readLines("https://archive.ics.uci.edu/ml/machine-learning-databases/voting-records/house-votes-84.names")[33:49]
ds1_names <- str_extract(ds1_names,"[[:alpha:]-]{2,40}")
ds1_names[1] <- "party"
names(ds1) <- ds1_names

kable(head(ds1))
glimpse(ds1)
```
##Tidy & mutate the data, remove non-yea-or-nay votes
```{r tidy_data}

party_agreement <- ds1 %>% 
  gather("voting_issue", "vote", 2:17) %>%
  filter(vote %in% c("y", "n")) %>% 
  group_by(party, voting_issue, vote) %>% 
  summarise(vote_count = n()) %>% 
  spread(vote, vote_count) %>% 
  rename(nay_votes = n, yea_votes = y) %>% 
  mutate(total_votes = nay_votes + yea_votes, 
         agreement_rate = pmax(nay_votes, yea_votes) / total_votes, 
         most_votes = ifelse(yea_votes > nay_votes, "yea", "nay")) %>% 
  select(party, voting_issue, agreement_rate, most_votes) 
    #switch("n" = "nay_votes", "y" = "yea_votes")

kable(head(party_agreement))
```

##Analysis that can be done:
1. Which issue attracted the most difference (in voting pattern) between members of congress according to affiliation?

*My interpretation of the question: On which issue was each party the most divided?*
```{r ds1q1}
party_agreement %>% 
  filter(party == "democrat") %>% 
  arrange(agreement_rate) %>% 
  head(1) %>% 
  kable()

party_agreement %>% 
  filter(party == "republican") %>% 
  arrange(agreement_rate) %>% 
  head(1) %>% 
  kable()
```


2. Which issue showed the most common ground (in voting pattern) between members of congress according to affiliation?

*My interpretation of the question: On which issue was each party the most unified?*
```{r ds1q2}
party_agreement %>% 
  filter(party == "democrat") %>% 
  arrange(desc(agreement_rate)) %>% 
  head(1) %>% 
  kable()

party_agreement %>% 
  filter(party == "republican") %>% 
  arrange(desc(agreement_rate)) %>% 
  head(1) %>% 
  kable()
```

#Dataset #2: Joel's GINI Index  

Measuring the wealth distribution between the people in each country has been something economists have been measuring for many years. In the GINI index, a higher GINI coefficient signifies inequality in wealth distribution, with 1 being complete inequality and 0 being complete equality. The World Bank has been maintaining [this data](http://databank.worldbank.org/data/reports.aspx?source=2&series=SI.POV.GINI&country=#).



A potential analysis that could be performed is the trend in the GINI coefficient for each country (or continent) or the average of the GINI coefficient. 

##Load data, get headers & take a look at it

```{r tidy}



```

#Now let's do some basic analysis with dply
##Which airline & city had the best on-time arrival rate?
```{r}


```

##Which airline had the better on-time arrival rate?
```{r analysis, tidy=F}

```

##Let's rank the cities by their overall on-time arrival rates.
```{r}

```

